
<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>中华白海豚科学与政策文本数据库</title>

<style>
:root{
  --bd:#cbd5e1;
  --muted:#52708a;
  --blue:#38bdf8;
  --deep:#0b4f75;
}

/* ===== 海洋背景 ===== */
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,"PingFang SC","Microsoft YaHei",Arial;
  margin:0;
  padding:24px 16px;
  color:#0f172a;
  background:
    radial-gradient(1200px 700px at 20% -10%, rgba(56,189,248,.35), transparent 60%),
    radial-gradient(1000px 600px at 90% 0%, rgba(14,165,233,.25), transparent 55%),
    linear-gradient(180deg, #eaf6ff 0%, #f3fbff 35%, #ffffff 100%);
}

/* ===== 主容器（雾面玻璃） ===== */
.container{
  max-width:1000px;
  margin:0 auto;
  background:rgba(255,255,255,.72);
  border:1px solid rgba(203,213,225,.9);
  border-radius:18px;
  padding:20px 18px;
  backdrop-filter: blur(8px);
  box-shadow:0 12px 32px rgba(2,84,140,.08);
}

h1{
  margin:0 0 6px 0;
  font-size:28px;
  letter-spacing:.5px;
}
.sub{
  color:var(--muted);
  margin:0 0 18px 0;
}

/* ===== 控件区 ===== */
.bar{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  margin-bottom:14px;
}
select,input[type=text],button{
  padding:10px 12px;
  border:1px solid var(--bd);
  border-radius:10px;
  font-size:14px;
  background:rgba(255,255,255,.9);
}
input[type=text]{flex:1;min-width:220px}
button{cursor:pointer}
button:hover{background:#fff}

/* ===== 年份范围条 ===== */
.range-box{
  border:1px solid var(--bd);
  border-radius:12px;
  padding:12px 14px;
  margin-bottom:10px;
}
.range-title{
  font-size:13px;
  color:var(--muted);
  margin-bottom:8px;
}

.range-wrap{position:relative;height:28px}
.range-track{
  position:absolute;
  left:0;right:0;top:50%;
  height:4px;
  background:rgba(148,163,184,.4);
  border-radius:2px;
  transform:translateY(-50%);
}
.range-fill{
  position:absolute;
  top:50%;
  height:4px;
  background:linear-gradient(90deg, rgba(56,189,248,.35), rgba(56,189,248,.75));
  border-radius:2px;
  transform:translateY(-50%);
}
.range-wrap input[type=range]{
  position:absolute;
  left:0;right:0;top:0;bottom:0;
  pointer-events:none;
  appearance:none;
  background:none;
}
.range-wrap input::-webkit-slider-thumb{
  pointer-events:auto;
  appearance:none;
  width:16px;height:16px;
  border-radius:50%;
  background:#0ea5e9;
  border:2px solid #fff;
  box-shadow:0 0 0 1px #7dd3fc;
}
.range-wrap input::-moz-range-thumb{
  pointer-events:auto;
  width:16px;height:16px;
  border-radius:50%;
  background:#0ea5e9;
  border:none;
}

/* ===== 列表动画 ===== */
#list{
  transition:opacity 220ms ease;
}
#list.is-updating{opacity:.35}

.stats{
  font-size:13px;
  color:var(--muted);
  margin:8px 0;
}

/* ===== 卡片 ===== */
.card{
  background:rgba(255,255,255,.78);
  border:1px solid rgba(203,213,225,.7);
  border-radius:14px;
  padding:12px 14px;
  margin:10px 0;
  box-shadow:0 6px 18px rgba(2,84,140,.06);
}
.title{font-weight:700;margin:0 0 6px 0}
.meta{font-size:13px;color:var(--muted);margin:0 0 8px 0}

.tag{
  display:inline-block;
  font-size:12px;
  background:rgba(56,189,248,.12);
  color:var(--deep);
  border-radius:999px;
  padding:2px 8px;
  margin:6px 6px 0 0;
}

a{color:#0284c7;text-decoration:none}
a:hover{text-decoration:underline}

.footer{
  margin-top:22px;
  font-size:12px;
  color:var(--muted);
}
</style>
</head>

<body>
<div class="container">

<h1>中华白海豚科学与政策文本数据库</h1>
<p class="sub">基于 GitHub Pages 的静态数据库（手动维护）</p>

<div class="bar">
  <select id="type"></select>
  <select id="country"></select>
  <input id="q" type="text" placeholder="搜索：标题 / 摘要 / 关键词 / 机构…" />
  <button id="exportBtn" type="button">导出 CSV</button>
</div>

<div class="range-box">
  <p class="range-title">
    年份范围：
    <b><span id="ymin"></span></b> —
    <b><span id="ymax"></span></b>
  </p>

  <div class="range-wrap">
    <div class="range-track"></div>
    <div class="range-fill" id="rangeFill"></div>
    <input id="yearMin" type="range" step="0.01">
    <input id="yearMax" type="range" step="0.01">
  </div>
</div>

<div class="stats" id="stats"></div>
<div id="list"></div>

<div class="footer">
  编辑 <code>data.json</code> 后提交，页面会自动更新
</div>

</div>

<script>
// ===== JS 与之前逻辑完全一致（省略注释，便于复制） =====
async function loadData(){const r=await fetch("./data.json",{cache:"no-store"});return await r.json();}
const elType=type,elCountry=country,elQ=q,exportBtn=document.getElementById("exportBtn");
const yearMin=document.getElementById("yearMin"),yearMax=document.getElementById("yearMax");
const fill=document.getElementById("rangeFill"),ymin=document.getElementById("ymin"),ymax=document.getElementById("ymax");
const list=document.getElementById("list"),stats=document.getElementById("stats");
let rows=[],lastFiltered=[],timer=null;const DEBOUNCE=200;
const uniq=a=>[...new Set(a)].filter(Boolean);
function opt(t,v){const o=document.createElement("option");o.textContent=t;o.value=v;return o;}
function schedule(){clearTimeout(timer);timer=setTimeout(render,DEBOUNCE);}
function build(){elType.innerHTML="";elCountry.innerHTML="";
  elType.appendChild(opt("全部类型",""));uniq(rows.map(r=>r.type)).forEach(v=>elType.appendChild(opt(v,v)));
  elCountry.appendChild(opt("全部国家",""));uniq(rows.map(r=>r.country)).forEach(v=>elCountry.appendChild(opt(v,v)));
  const ys=rows.map(r=>+r.year).filter(Boolean);yearMin.min=yearMax.min=Math.min(...ys);
  yearMin.max=yearMax.max=Math.max(...ys);yearMin.value=yearMin.min;yearMax.value=yearMax.max;update();
}
function bounds(){let a=Math.round(yearMin.value),b=Math.round(yearMax.value);if(a>b)[a,b]=[b,a];return{a,b};}
function update(){
  if(+yearMin.value>+yearMax.value)[yearMin.value,yearMax.value]=[yearMax.value,yearMin.value];
  const min=+yearMin.min,max=+yearMin.max,t=max-min||1;
  const l=((+yearMin.value-min)/t)*100,r=((+yearMax.value-min)/t)*100;
  fill.style.left=l+"%";fill.style.width=(r-l)+"%";
  const {a,b}=bounds();ymin.textContent=a;ymax.textContent=b;
}
function snap(){yearMin.value=Math.round(yearMin.value);yearMax.value=Math.round(yearMax.value);update();schedule();}
function match(r){
  if(elType.value&&r.type!==elType.value)return false;
  if(elCountry.value&&r.country!==elCountry.value)return false;
  const {a,b}=bounds();if(r.year<a||r.year>b)return false;
  const q=elQ.value.trim().toLowerCase();
  return !q||[r.title,r.abstract,r.org,(r.tags||[]).join(" ")].join(" ").toLowerCase().includes(q);
}
function render(){
  list.classList.add("is-updating");
  setTimeout(()=>{
    lastFiltered=rows.filter(match);
    stats.textContent=`显示 ${lastFiltered.length} 条（共 ${rows.length} 条）`;
    list.innerHTML="";
    lastFiltered.forEach(r=>{
      list.insertAdjacentHTML("beforeend",`
        <div class="card">
          <p class="title">[${r.type}] ${r.title}</p>
          <p class="meta">${r.org||""} · ${r.year} · ${r.country}
          ${r.link?`· <a href="${r.link}" target="_blank">来源</a>`:""}</p>
          <div>${r.abstract||""}</div>
          <div>${(r.tags||[]).map(t=>`<span class="tag">${t}</span>`).join("")}</div>
        </div>`);
    });
    requestAnimationFrame(()=>list.classList.remove("is-updating"));
  },200);
}
function exportCSV(){
  if(!lastFiltered.length)return alert("当前筛选结果为空");
  const h=["类型","标题","机构","国家","年份","摘要","关键词","链接"];
  const esc=s=>/[",\n]/.test(s)?'"'+s.replace(/"/g,'""')+'"':s;
  const lines=[h.join(",")].concat(lastFiltered.map(r=>[
    r.type,r.title,r.org,r.country,r.year,r.abstract,(r.tags||[]).join(";"),r.link
  ].map(v=>esc(String(v||""))).join(",")));
  const csv="\ufeff"+lines.join("\n");
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
  a.download="dolphin_db.csv";a.click();
}
loadData().then(d=>{
  rows=d.sort((a,b)=>b.year-a.year);
  build();render();
  [elType,elCountry,yearMin,yearMax].forEach(e=>e.oninput=()=>{update();schedule();});
  [yearMin,yearMax].forEach(e=>e.onchange=snap);
  elQ.oninput=schedule;exportBtn.onclick=exportCSV;
});
</script>
</body>
</html>

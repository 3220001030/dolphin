

<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>中华白海豚科学与政策文本数据库</title>

<style>
:root{
  --bd:#cbd5e1;
  --muted:#52708a;
  --blue:#38bdf8;
  --deep:#0b4f75;
}

body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,"PingFang SC","Microsoft YaHei",Arial;
  margin:0;
  padding:24px 16px;
  color:#0f172a;
  background:
    radial-gradient(1200px 700px at 20% -10%, rgba(56,189,248,.35), transparent 60%),
    radial-gradient(1000px 600px at 90% 0%, rgba(14,165,233,.25), transparent 55%),
    linear-gradient(180deg, #eaf6ff 0%, #f3fbff 35%, #ffffff 100%);
}

.container{
  max-width:1000px;
  margin:0 auto;
  background:rgba(255,255,255,.72);
  border:1px solid rgba(203,213,225,.9);
  border-radius:18px;
  padding:18px 18px 20px;
  backdrop-filter: blur(8px);
  box-shadow:0 12px 32px rgba(2,84,140,.08);
}

h1{ margin:0 0 6px 0; font-size:28px; letter-spacing:.5px; }
.sub{ color:var(--muted); margin:0 0 14px 0; }

/* 顶部选项卡 */
.tabs{
  display:flex; gap:10px; flex-wrap:wrap;
  margin:8px 0 16px;
}
.tabbtn{
  border:1px solid var(--bd);
  background:rgba(255,255,255,.85);
  border-radius:999px;
  padding:8px 12px;
  font-size:14px;
  cursor:pointer;
}
.tabbtn[aria-selected="true"]{
  border-color: rgba(56,189,248,.65);
  box-shadow:0 0 0 3px rgba(56,189,248,.18);
}

/* 面板淡入淡出（用于选项卡缓冲） */
.tabpanel{
  opacity:0;
  pointer-events:none;
  transition:opacity 200ms ease;
  display:none; /* 默认隐藏 */
}
.tabpanel.active{
  display:block;
  opacity:1;
  pointer-events:auto;
}
/* 离开态：仍显示但淡出（避免 display:none 立刻消失） */
.tabpanel.leaving{
  display:block;
  opacity:0;
  pointer-events:none;
}

/* 控件区 */
.bar{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
  margin-bottom:14px;
}
select,input[type=text],button{
  padding:10px 12px;
  border:1px solid var(--bd);
  border-radius:10px;
  font-size:14px;
  background:rgba(255,255,255,.9);
}
input[type=text]{flex:1;min-width:220px}
button{cursor:pointer}
button:hover{background:#fff}

/* 年份范围条 */
.range-box{
  border:1px solid var(--bd);
  border-radius:12px;
  padding:12px 14px;
  margin-bottom:10px;
  background:rgba(255,255,255,.55);
}
.range-title{ font-size:13px; color:var(--muted); margin:0 0 8px 0; }

.range-wrap{position:relative;height:28px}
.range-track{
  position:absolute; left:0;right:0;top:50%;
  height:4px; background:rgba(148,163,184,.4);
  border-radius:2px; transform:translateY(-50%);
}
.range-fill{
  position:absolute; top:50%;
  height:4px;
  background:linear-gradient(90deg, rgba(56,189,248,.35), rgba(56,189,248,.75));
  border-radius:2px; transform:translateY(-50%);
}
.range-wrap input[type=range]{
  position:absolute; left:0;right:0;top:0;bottom:0;
  pointer-events:none; appearance:none; background:none;
}
.range-wrap input::-webkit-slider-thumb{
  pointer-events:auto; appearance:none;
  width:16px;height:16px;border-radius:50%;
  background:#0ea5e9;border:2px solid #fff;
  box-shadow:0 0 0 1px #7dd3fc;
}
.range-wrap input::-moz-range-thumb{
  pointer-events:auto;
  width:16px;height:16px;border-radius:50%;
  background:#0ea5e9;border:none;
}

/* 列表淡入淡出（只在最终刷新时触发一次） */
#list{ transition:opacity 220ms ease; }
#list.is-updating{ opacity:.35; }

.stats{ font-size:13px; color:var(--muted); margin:8px 0; }

/* 卡片 */
.card{
  background:rgba(255,255,255,.78);
  border:1px solid rgba(203,213,225,.7);
  border-radius:14px;
  padding:12px 14px;
  margin:10px 0;
  box-shadow:0 6px 18px rgba(2,84,140,.06);
}
.title{font-weight:700;margin:0 0 6px 0}
.meta{font-size:13px;color:var(--muted);margin:0 0 8px 0}
.tag{
  display:inline-block;
  font-size:12px;
  background:rgba(56,189,248,.12);
  color:var(--deep);
  border-radius:999px;
  padding:2px 8px;
  margin:6px 6px 0 0;
}

a{color:#0284c7;text-decoration:none}
a:hover{text-decoration:underline}

.footer{ margin-top:22px; font-size:12px; color:var(--muted); }

/* ===== 科学-政策接口可视化 ===== */
.viz-head{
  display:flex; gap:10px; flex-wrap:wrap; align-items:stretch;
  margin:6px 0 10px;
}
.kpi{
  flex:1;
  min-width:220px;
  border:1px solid rgba(203,213,225,.7);
  border-radius:14px;
  padding:12px 14px;
  background:rgba(255,255,255,.78);
  box-shadow:0 6px 18px rgba(2,84,140,.06);
}
.kpi .k{font-size:12px;color:var(--muted);margin:0}
.kpi .v{font-size:22px;font-weight:800;margin:2px 0 0}
.kpi .s{font-size:12px;color:var(--muted);margin:6px 0 0}

.viz-box{
  border:1px solid var(--bd);
  border-radius:12px;
  padding:12px 14px;
  background:rgba(255,255,255,.72);
}
.viz-title{
  margin:0 0 10px;
  font-weight:700;
}
.row{
  display:grid;
  grid-template-columns: 160px 1fr 90px;
  gap:10px;
  align-items:center;
  padding:8px 0;
  border-top:1px dashed rgba(203,213,225,.7);
}
.row:first-of-type{ border-top:none; }
.country-name{ font-weight:600; }
.barwrap{
  position:relative;
  height:10px;
  border-radius:999px;
  background:rgba(148,163,184,.25);
  overflow:hidden;
}
.barfill{
  height:100%;
  background:linear-gradient(90deg, rgba(56,189,248,.35), rgba(14,165,233,.85));
  width:0%;
}
.badge{
  justify-self:end;
  font-size:12px;
  border:1px solid rgba(203,213,225,.7);
  background:rgba(255,255,255,.75);
  border-radius:999px;
  padding:3px 8px;
  color:var(--deep);
}
.smallnote{ color:var(--muted); font-size:12px; margin:10px 0 0; }
.table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
  font-size:13px;
}
.table th,.table td{
  padding:10px 8px;
  border-top:1px solid rgba(203,213,225,.7);
  text-align:left;
  vertical-align:top;
}
.table th{ color:var(--muted); font-weight:600; }
.mono{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
</style>
</head>

<body>
<div class="container">

<h1>中华白海豚科学与政策文本数据库</h1>
<p class="sub">基于 GitHub Pages 的静态数据库（手动维护）</p>

<div class="tabs" role="tablist" aria-label="页面选项卡">
  <button class="tabbtn" id="tab-db-btn" role="tab" aria-controls="tab-db" aria-selected="true">数据库</button>
  <button class="tabbtn" id="tab-spi-btn" role="tab" aria-controls="tab-spi" aria-selected="false">科学-政策接口</button>
</div>

<section id="tab-db" class="tabpanel active" role="tabpanel" aria-labelledby="tab-db-btn">
  <div class="bar">
    <select id="type"></select>
    <select id="country"></select>
    <input id="q" type="text" placeholder="搜索：标题 / 摘要 / 关键词 / 机构…" />
    <button id="exportBtn" type="button">导出 CSV</button>
  </div>

  <div class="range-box">
    <p class="range-title">
      年份范围：<b><span id="ymin"></span></b> — <b><span id="ymax"></span></b>
    </p>

    <div class="range-wrap">
      <div class="range-track"></div>
      <div class="range-fill" id="rangeFill"></div>
      <input id="yearMin" type="range" step="0.01">
      <input id="yearMax" type="range" step="0.01">
    </div>
  </div>

  <div class="stats" id="stats"></div>
  <div id="list"></div>

  <div class="footer">
    编辑 <code>data.json</code> 后提交，页面会自动更新
  </div>
</section>

<section id="tab-spi" class="tabpanel" role="tabpanel" aria-labelledby="tab-spi-btn">
  <div class="viz-head">
    <div class="kpi">
      <p class="k">总体匹配指数</p>
      <p class="v" id="kpiScore">—</p>
      <p class="s">按国家/地区对齐：<span class="mono">min(论文数,政策数)/max(论文数,政策数)</span> 的加权平均</p>
    </div>
    <div class="kpi">
      <p class="k">覆盖国家/地区数</p>
      <p class="v" id="kpiCountries">—</p>
      <p class="s">统计 data.json 中出现过的国家/地区</p>
    </div>
    <div class="kpi">
      <p class="k">论文 vs 政策</p>
      <p class="v" id="kpiCounts">—</p>
      <p class="s">用来判断是“科研多政策少”还是相反</p>
    </div>
  </div>

  <div class="viz-box">
    <p class="viz-title">国家/地区维度匹配程度（越高越“科学-政策对齐”）</p>
    <div id="matchBars"></div>
    <p class="smallnote">
      解释：每个国家/地区计算 <span class="mono">match = min(Papers, Policies) / max(Papers, Policies)</span>（0–1），再显示为百分比。
      这不是“质量评价”，只是“数量层面的接口成熟度”指示器。
    </p>

    <table class="table" aria-label="国家/地区匹配明细表">
      <thead>
        <tr>
          <th>国家/地区</th>
          <th>论文数</th>
          <th>政策数</th>
          <th>匹配度</th>
          <th>建议（极简）</th>
        </tr>
      </thead>
      <tbody id="matchTable"></tbody>
    </table>
  </div>

  <div class="footer">
    提示：如果某国“政策=0”，可以先补充该国/地区的相关法规、行动计划、管理条例等条目（仍用同一 data.json 结构）。
  </div>
</section>

</div>

<script>
async function loadData(){
  const r = await fetch("./data.json", { cache: "no-store" });
  if(!r.ok) throw new Error("无法加载 data.json（请确认与 index.html 同目录）");
  return await r.json();
}

/* ======================
   选项卡逻辑（200ms 缓冲 + 淡入淡出）
====================== */
const tabDbBtn = document.getElementById("tab-db-btn");
const tabSpiBtn = document.getElementById("tab-spi-btn");
const tabDb = document.getElementById("tab-db");
const tabSpi = document.getElementById("tab-spi");

const TAB_DELAY = 200;
let tabTimer = null;

function setAriaSelected(which){
  const isDb = which === "db";
  tabDbBtn.setAttribute("aria-selected", String(isDb));
  tabSpiBtn.setAttribute("aria-selected", String(!isDb));
}

function showPanel(which){
  const isDb = which === "db";
  tabDb.classList.toggle("active", isDb);
  tabSpi.classList.toggle("active", !isDb);
}

function switchTabBuffered(which){
  clearTimeout(tabTimer);
  const targetIsDb = which === "db";
  if(targetIsDb && tabDb.classList.contains("active")) return;
  if(!targetIsDb && tabSpi.classList.contains("active")) return;

  const from = targetIsDb ? tabSpi : tabDb;
  const to   = targetIsDb ? tabDb  : tabSpi;
  from.classList.add("leaving");

  setAriaSelected(which);
  location.hash = targetIsDb ? "#db" : "#spi";

  tabTimer = setTimeout(() => {
    from.classList.remove("active", "leaving");
    to.classList.remove("leaving");
    to.classList.add("active");
  }, TAB_DELAY);
}

tabDbBtn.addEventListener("click", () => switchTabBuffered("db"));
tabSpiBtn.addEventListener("click", () => switchTabBuffered("spi"));

if(location.hash === "#spi"){
  setAriaSelected("spi");
  showPanel("spi");
} else {
  setAriaSelected("db");
  showPanel("db");
}

/* ======================
   数据库页（按 data.json 真实字段）
====================== */
const elType = document.getElementById("type");
const elCountry = document.getElementById("country");
const elQ = document.getElementById("q");
const exportBtn = document.getElementById("exportBtn");

const yearMin = document.getElementById("yearMin");
const yearMax = document.getElementById("yearMax");
const fill = document.getElementById("rangeFill");
const ymin = document.getElementById("ymin");
const ymax = document.getElementById("ymax");

const list = document.getElementById("list");
const stats = document.getElementById("stats");

let rows = [];
let lastFiltered = [];
let renderTimer = null;
const DEBOUNCE_MS = 200;

function scheduleRender(){
  clearTimeout(renderTimer);
  renderTimer = setTimeout(() => renderListWithFade(), DEBOUNCE_MS);
}

const uniq = a => Array.from(new Set(a.filter(v => v !== null && v !== undefined && String(v).trim() !== "")));

function opt(label, value){
  const o = document.createElement("option");
  o.textContent = label;
  o.value = value;
  return o;
}

function safeText(v){
  return v === null || v === undefined ? "" : String(v);
}

function escapeHtml(v){
  return safeText(v)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#39;");
}

function splitFunctionTags(v){
  return safeText(v).split(";").map(s => s.trim()).filter(Boolean);
}

function buildFilters(){
  elType.innerHTML = "";
  elCountry.innerHTML = "";

  elType.appendChild(opt("全部文本类型", ""));
  uniq(rows.map(r => r.document_type)).sort((a,b)=>String(a).localeCompare(String(b), "zh")).forEach(v => {
    elType.appendChild(opt(v, v));
  });

  elCountry.appendChild(opt("全部国家/地区", ""));
  uniq(rows.map(r => r.country_or_region)).sort((a,b)=>String(a).localeCompare(String(b), "zh")).forEach(v => {
    elCountry.appendChild(opt(v, v));
  });

  const ys = rows.map(r => Number(r.year)).filter(y => Number.isFinite(y) && y > 0);
  const minY = ys.length ? Math.min(...ys) : 1900;
  const maxY = ys.length ? Math.max(...ys) : new Date().getFullYear();

  yearMin.min = yearMax.min = minY;
  yearMin.max = yearMax.max = maxY;
  yearMin.value = minY;
  yearMax.value = maxY;

  updateRangeVisual();
}

function getYearBounds(){
  let a = Math.round(Number(yearMin.value));
  let b = Math.round(Number(yearMax.value));
  if(a > b) [a, b] = [b, a];
  return { a, b };
}

function updateRangeVisual(){
  if(Number(yearMin.value) > Number(yearMax.value)){
    const t = yearMin.value;
    yearMin.value = yearMax.value;
    yearMax.value = t;
  }

  const minVal = Number(yearMin.value);
  const maxVal = Number(yearMax.value);
  const minAll = Number(yearMin.min);
  const maxAll = Number(yearMin.max);
  const total = (maxAll - minAll) || 1;

  const left = ((minVal - minAll) / total) * 100;
  const right = ((maxVal - minAll) / total) * 100;

  fill.style.left = left + "%";
  fill.style.width = Math.max(0, right - left) + "%";

  const { a, b } = getYearBounds();
  ymin.textContent = a;
  ymax.textContent = b;
}

function snapToInteger(){
  yearMin.value = String(Math.round(Number(yearMin.value)));
  yearMax.value = String(Math.round(Number(yearMax.value)));
  if(Number(yearMin.value) > Number(yearMax.value)){
    const t = yearMin.value;
    yearMin.value = yearMax.value;
    yearMax.value = t;
  }
  updateRangeVisual();
  scheduleRender();
}

function match(r){
  if(elType.value && safeText(r.document_type) !== elType.value) return false;
  if(elCountry.value && safeText(r.country_or_region) !== elCountry.value) return false;

  const { a, b } = getYearBounds();
  const y = Number(r.year);
  if(Number.isFinite(y) && (y < a || y > b)) return false;

  const q = elQ.value.trim().toLowerCase();
  if(!q) return true;

  const hay = [
    r.document_title,
    r.document_type,
    r.country_or_region,
    r.subnational_area,
    r.jurisdiction,
    r.language,
    r.hierarchy_level,
    r.targeting_category,
    r.function_type,
    r.taxon_label_used_in_text,
    r.notes,
    r.source_url,
    String(r.year || "")
  ].map(safeText).join(" ").toLowerCase();

  return hay.includes(q);
}

function renderListWithFade(){
  list.classList.add("is-updating");

  setTimeout(() => {
    lastFiltered = rows.filter(match);
    stats.textContent = `显示 ${lastFiltered.length} 条（共 ${rows.length} 条）`;

    list.innerHTML = "";
    for(const r of lastFiltered){
      const tags = [
        safeText(r.jurisdiction),
        safeText(r.document_type),
        safeText(r.hierarchy_level),
        safeText(r.targeting_category) ? `分类 ${safeText(r.targeting_category)}` : "",
        safeText(r.language)
      ].filter(Boolean);
      const functionTags = splitFunctionTags(r.function_type);
      const tagsHtml = [...tags, ...functionTags].map(t => `<span class="tag">${escapeHtml(t)}</span>`).join("");

      const metaParts = [
        safeText(r.country_or_region),
        safeText(r.subnational_area),
        safeText(r.year),
        safeText(r.taxon_label_used_in_text)
      ].filter(Boolean);

      const notesHtml = safeText(r.notes)
        ? `<div style="margin-top:8px;color:#475569;font-size:13px;">备注：${escapeHtml(r.notes)}</div>`
        : "";

      list.insertAdjacentHTML("beforeend", `
        <div class="card">
          <p class="title">${escapeHtml(r.document_title)}</p>
          <p class="meta">
            ${escapeHtml(metaParts.join(" · "))}
            ${r.source_url ? ` · <a href="${escapeHtml(r.source_url)}" target="_blank" rel="noopener">来源链接</a>` : ""}
          </p>
          <div><strong>功能类型：</strong>${escapeHtml(safeText(r.function_type) || "未标注")}</div>
          ${notesHtml}
          <div>${tagsHtml}</div>
        </div>
      `);
    }

    if(!lastFiltered.length){
      list.innerHTML = `<div class="card"><p class="title">没有匹配结果</p><div>请调整筛选条件、年份范围或搜索关键词。</div></div>`;
    }

    requestAnimationFrame(() => list.classList.remove("is-updating"));
  }, 200);
}

function csvEscape(v){
  const s = (v === null || v === undefined) ? "" : String(v);
  if (s.includes('"') || s.includes(',') || s.includes('\n') || s.includes('\r')) {
    return '"' + s.replace(/"/g, '""') + '"';
  }
  return s;
}

function exportCSV(){
  if(!lastFiltered.length){
    alert("当前筛选结果为空，无法导出。");
    return;
  }
  const header = [
    "id","jurisdiction","country_or_region","subnational_area","language","year",
    "document_title","document_type","hierarchy_level","targeting_category",
    "function_type","taxon_label_used_in_text","source_url","notes"
  ];
  const lines = [header.map(csvEscape).join(",")];

  for(const r of lastFiltered){
    const row = header.map(k => r[k]);
    lines.push(row.map(csvEscape).join(","));
  }

  const csv = "\ufeff" + lines.join("\n");
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8"});
  const url = URL.createObjectURL(blob);

  const d = new Date();
  const pad = n => String(n).padStart(2, "0");
  const fname = `dolphin_policy_db_${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}.csv`;

  const a = document.createElement("a");
  a.href = url;
  a.download = fname;
  document.body.appendChild(a);
  a.click();
  a.remove();
  setTimeout(() => URL.revokeObjectURL(url), 1000);
}

/* ======================
   科学-政策接口（改为数据概览）
====================== */
const kpiScore = document.getElementById("kpiScore");
const kpiCountries = document.getElementById("kpiCountries");
const kpiCounts = document.getElementById("kpiCounts");
const matchBars = document.getElementById("matchBars");
const matchTable = document.getElementById("matchTable");

function computeOverview(allRows){
  const byCountry = new Map();
  for(const r of allRows){
    const key = safeText(r.country_or_region) || "未标注";
    if(!byCountry.has(key)) byCountry.set(key, { country:key, total:0, a:0, b:0, c:0 });
    const obj = byCountry.get(key);
    obj.total += 1;
    const cat = safeText(r.targeting_category).toUpperCase();
    if(cat === "A") obj.a += 1;
    else if(cat === "B") obj.b += 1;
    else if(cat === "C") obj.c += 1;
  }

  const arr = Array.from(byCountry.values()).map(d => ({
    ...d,
    score: d.total ? Math.round((d.a / d.total) * 100) : 0
  }));
  const overall = allRows.length ? Math.round((allRows.filter(r => safeText(r.targeting_category).toUpperCase() === "A").length / allRows.length) * 100) : 0;
  return { arr, overall };
}

function renderSPI(){
  const { arr, overall } = computeOverview(rows);
  const countries = new Set(rows.map(r => safeText(r.country_or_region)).filter(Boolean)).size;
  const totalA = rows.filter(r => safeText(r.targeting_category).toUpperCase() === "A").length;

  kpiScore.textContent = overall + "%";
  kpiCountries.textContent = String(countries);
  kpiCounts.textContent = `${totalA} / ${rows.length}`;

  const sorted = [...arr].sort((a,b)=> (b.total-a.total) || (b.score-a.score) || a.country.localeCompare(b.country, "zh"));

  matchBars.innerHTML = "";
  matchTable.innerHTML = "";

  for(const d of sorted){
    const row = document.createElement("div");
    row.className = "row";
    row.innerHTML = `
      <div class="country-name">${escapeHtml(d.country)}</div>
      <div class="barwrap"><div class="barfill" style="width:${Math.max(6, d.score)}%;"></div></div>
      <div class="badge">${d.total} 条</div>
    `;
    matchBars.appendChild(row);

    let suggestion = "继续补充更直接的 A 类专项文本";
    if(d.a > 0 && d.a === d.total) suggestion = "以直接针对物种的文本为主";
    else if(d.a >= Math.ceil(d.total / 2)) suggestion = "专项文本占比较高";
    else if(d.a === 0) suggestion = "缺少 A 类，建议补专项计划/物种保护规定";

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${escapeHtml(d.country)}</td>
      <td>${d.a}</td>
      <td>${d.total - d.a}</td>
      <td>${d.score}%</td>
      <td>${escapeHtml(suggestion)}</td>
    `;
    matchTable.appendChild(tr);
  }
}

async function main(){
  rows = await loadData();
  rows = Array.isArray(rows) ? rows : [];

  rows.sort((a,b) => {
    const y = Number(b.year || 0) - Number(a.year || 0);
    if(y) return y;
    return safeText(a.document_title).localeCompare(safeText(b.document_title), "zh");
  });

  // 同步 UI 文案，使它和真实字段一致
  if(elType.options.length === 0) buildFilters();
  elQ.placeholder = "搜索：标题 / 地区 / 文本类型 / 功能类型 / 分类 / 备注…";
  document.querySelector('#tab-spi .kpi .k').textContent = 'A类专项文本占比';
  document.querySelectorAll('#tab-spi .kpi .s')[0].textContent = 'A类 = 直接点名白海豚 / Sousa 的文本占全部条目的比例';
  document.querySelectorAll('#tab-spi .kpi .k')[1].textContent = '覆盖国家/地区数';
  document.querySelectorAll('#tab-spi .kpi .k')[2].textContent = 'A类 / 总条目';
  document.querySelectorAll('#tab-spi .kpi .s')[2].textContent = '用于判断数据库里“直接针对物种”的文本占比';
  document.querySelector('.viz-title').textContent = '国家/地区条目规模（并以 A 类占比作参考）';
  document.querySelector('.smallnote').innerHTML = '解释：这里不再使用“论文 vs 政策”模型，而是按你当前 <span class="mono">data.json</span> 的真实结构，显示各国家/地区条目数，并用 <span class="mono">A类占比</span> 作为“直接针对物种程度”的参考。';
  const ths = document.querySelectorAll('#tab-spi thead th');
  if(ths.length >= 5){
    ths[1].textContent = 'A类';
    ths[2].textContent = '非A类';
    ths[3].textContent = 'A类占比';
    ths[4].textContent = '建议（极简）';
  }
  const spiFooter = document.querySelectorAll('#tab-spi .footer')[0];
  if(spiFooter) spiFooter.textContent = '提示：如果某国家/地区 A 类文本较少，可以优先补充该地区直接点名白海豚 / Sousa 的专项法规、行动计划、管理办法或保护区制度。';

  renderListWithFade();
  renderSPI();

  elType.addEventListener("change", scheduleRender);
  elCountry.addEventListener("change", scheduleRender);
  elQ.addEventListener("input", scheduleRender);

  yearMin.addEventListener("input", updateRangeVisual);
  yearMax.addEventListener("input", updateRangeVisual);
  yearMin.addEventListener("change", snapToInteger);
  yearMax.addEventListener("change", snapToInteger);

  exportBtn.addEventListener("click", exportCSV);
}

main().catch(e => {
  stats.textContent = String(e.message || e);
});
</script>
</body>
</html>
